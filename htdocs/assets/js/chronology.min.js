/* globals $, Config */

/**
 * frontend/chronologies/index
 */
$(document).ready(function () {
    'use strict';

    if (typeof filmotecaConfig.chronology === 'undefined') {
        return;
    }

    var MIN_YEAR_INDEX = 0;
    var MAX_YEAR_INDEX = 1;

    var $yeareventSelector = $('#yearevent-selector');
    var $events = $('#events > .item');
    var $results = $('#results');
    var $itemsWrapper = $('.wrapper-items');
    var foundEvents = 0;

    /***********************
     * Slider
     ***********************/

    var filterEvents = function (event, ui) {
        foundEvents = 0;
        $events.each(function (index, event) {
            var $event = $(event);
            var year = parseInt($event.data('year'));

             if (year >= ui.values[MIN_YEAR_INDEX] && year <= ui.values[MAX_YEAR_INDEX]) {
                $event.show();
                foundEvents++;
            } else {
                $event.hide();
            }
        });

        $results.children('.number').html(foundEvents);
    };

    // // Events
    // // The user move the nuts of the years
    $yeareventSelector.on('slidechange', filterEvents);

    // Initializes the default status

    $yeareventSelector.on('slidecreate', function () {
        filterEvents({}, {values: filmotecaConfig.chronology.slider.value});
    });

            

    // Initialization of slider
    $yeareventSelector
        .slider({
            range: true,
            min : filmotecaConfig.chronology.slider.minYear,
            max: filmotecaConfig.chronology.slider.maxYear,
            step: 1,
            values: filmotecaConfig.chronology.slider.value,
            animate: true
        })
        .slider('pips',{
            rest: 'label',
            step: filmotecaConfig.chronology.slider.step
        })
        .slider('float', {});

    /*****************
     * Autocomple
     ******************/

    $( '#winner-searcher' ).autocomplete({
        minLength: 0,
        source: '/chronology',
        select: function(event, ui) {
            eventId = ui.item.id;
            $modalBody.html('<div class="loading loading-box-md center-block"></div>');
            $modal.modal('show');
            return false;
        }
    })
        .autocomplete( 'instance' )._renderItem = function(ul, item) {
        return $('<li>')
            .append(
                '<div>'+ item.year + '</div>'
            )
            .appendTo(ul);
    };
});
